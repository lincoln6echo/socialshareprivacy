/*
 * jquery.socialshareprivacy.js | 2 Klicks fuer mehr Datenschutz
 *
 * http://www.heise.de/extras/socialshareprivacy/
 * http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html
 *
 * Copyright (c) 2011 Hilko Holweg, Sebastian Hilbig, Nicolas Heiringhoff, Juergen Schmidt,
 * Heise Zeitschriften Verlag GmbH & Co. KG, http://www.heise.de
 *
 * is released under the MIT License http://www.opensource.org/licenses/mit-license.php
 *
 * Spread the word, link to us if you can.
 */
(function(e){"use strict";function t(e,t){var n=decodeURIComponent(e);if(n.length<=t){return e}var r=n.substring(0,t-1).lastIndexOf(" ");n=encodeURIComponent(n.substring(0,r))+"…";return n}function n(t){var n=e('meta[name="'+t+'"]').attr("content");return n||""}function r(){var t=n("DC.title");var r=n("DC.creator");if(t.length>0&&r.length>0){t+=" - "+r}else{t=e("title").text()}return encodeURIComponent(t)}function i(){var t=document.location.href;var n=e("link[rel=canonical]").attr("href");if(n&&n.length>0){if(n.indexOf("http")<0){n=document.location.protocol+"//"+document.location.host+n}t=n}return t}function s(e,t,n,r,i){var s=new Date;s.setTime(s.getTime()+n*24*60*60*1e3);document.cookie=e+"="+t+"; expires="+s.toUTCString()+"; path="+r+"; domain="+i}function o(e,t,n,r){var i=new Date;i.setTime(i.getTime()-100);document.cookie=e+"="+t+"; expires="+i.toUTCString()+"; path="+n+"; domain="+r}e.fn.socialSharePrivacy=function(n){var u={services:{facebook:{status:"on",dummy_img:"socialshareprivacy/images/dummy_facebook.png",txt_info:"2 Klicks für mehr Datenschutz: Erst wenn Sie hier klicken, wird der Button aktiv und Sie können Ihre Empfehlung an Facebook senden. Schon beim Aktivieren werden Daten an Dritte übertragen – siehe <em>i</em>.",txt_fb_off:"nicht mit Facebook verbunden",txt_fb_on:"mit Facebook verbunden",perma_option:"on",display_name:"Facebook",referrer_track:"",language:"de_DE",action:"recommend"},twitter:{status:"on",dummy_img:"socialshareprivacy/images/dummy_twitter.png",txt_info:"2 Klicks für mehr Datenschutz: Erst wenn Sie hier klicken, wird der Button aktiv und Sie können Ihre Empfehlung an Twitter senden. Schon beim Aktivieren werden Daten an Dritte übertragen – siehe <em>i</em>.",txt_twitter_off:"nicht mit Twitter verbunden",txt_twitter_on:"mit Twitter verbunden",perma_option:"on",display_name:"Twitter",referrer_track:"",tweet_text:r,language:"en"},gplus:{status:"on",dummy_img:"socialshareprivacy/images/dummy_gplus.png",txt_info:"2 Klicks für mehr Datenschutz: Erst wenn Sie hier klicken, wird der Button aktiv und Sie können Ihre Empfehlung an Google+ senden. Schon beim Aktivieren werden Daten an Dritte übertragen – siehe <em>i</em>.",txt_gplus_off:"nicht mit Google+ verbunden",txt_gplus_on:"mit Google+ verbunden",perma_option:"on",display_name:"Google+",referrer_track:"",language:"de"}},info_link:"http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html",txt_help:"Wenn Sie diese Felder durch einen Klick aktivieren, werden Informationen an Facebook, Twitter oder Google in die USA übertragen und unter Umständen auch dort gespeichert. Näheres erfahren Sie durch einen Klick auf das <em>i</em>.",settings_perma:"Dauerhaft aktivieren und Datenüber­tragung zustimmen:",cookie_path:"/",cookie_domain:document.location.host,cookie_expires:"365",css_path:"socialshareprivacy/socialshareprivacy.css",uri:i};var a=e.extend(true,u,n);var f=a.services.facebook.status==="on";var l=a.services.twitter.status==="on";var c=a.services.gplus.status==="on";if(!f&&!l&&!c){return}if(a.css_path.length>0){if(document.createStyleSheet){document.createStyleSheet(a.css_path)}else{e("head").append('<link rel="stylesheet" type="text/css" href="'+a.css_path+'" />')}}return this.each(function(){e(this).prepend('<ul class="social_share_privacy_area"></ul>');var n=e(".social_share_privacy_area",this);var r=a.uri;if(typeof r==="function"){r=r(n)}if(f){var i=encodeURIComponent(r+a.services.facebook.referrer_track);var u='<iframe src="http://www.facebook.com/plugins/like.php?locale='+a.services.facebook.language+"&href="+i+"&send=false&layout=button_count&width=120&show_faces=false&action="+a.services.facebook.action+'&colorscheme=light&font&height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:145px; height:21px;" allowTransparency="true"></iframe>';var h='<img src="'+a.services.facebook.dummy_img+'" alt="Facebook "Like"-Dummy" class="fb_like_privacy_dummy" />';n.append('<li class="facebook help_info"><span class="info">'+a.services.facebook.txt_info+'</span><span class="switch off">'+a.services.facebook.txt_fb_off+'</span><div class="fb_like dummy_btn">'+h+"</div></li>");var p=e("li.facebook",n);e("li.facebook div.fb_like img.fb_like_privacy_dummy,li.facebook span.switch",n).on("click",function(){if(p.find("span.switch").hasClass("off")){p.addClass("info_off");p.find("span.switch").addClass("on").removeClass("off").html(a.services.facebook.txt_fb_on);p.find("img.fb_like_privacy_dummy").replaceWith(u)}else{p.removeClass("info_off");p.find("span.switch").addClass("off").removeClass("on").html(a.services.facebook.txt_fb_off);p.find(".fb_like").html(h)}})}if(l){var d=a.services.twitter.tweet_text;if(typeof d==="function"){d=d()}d=t(d,"120");var v=encodeURIComponent(r+a.services.twitter.referrer_track);var m=encodeURIComponent(r);var g='<iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url='+v+"&counturl="+m+"&text="+d+"&count=horizontal&lang="+a.services.twitter.language+'" style="width:130px; height:25px;"></iframe>';var y='<img src="'+a.services.twitter.dummy_img+'" alt=""Tweet this"-Dummy" class="tweet_this_dummy" />';n.append('<li class="twitter help_info"><span class="info">'+a.services.twitter.txt_info+'</span><span class="switch off">'+a.services.twitter.txt_twitter_off+'</span><div class="tweet dummy_btn">'+y+"</div></li>");var b=e("li.twitter",n);e("li.twitter div.tweet img,li.twitter span.switch",n).on("click",function(){if(b.find("span.switch").hasClass("off")){b.addClass("info_off");b.find("span.switch").addClass("on").removeClass("off").html(a.services.twitter.txt_twitter_on);b.find("img.tweet_this_dummy").replaceWith(g)}else{b.removeClass("info_off");b.find("span.switch").addClass("off").removeClass("on").html(a.services.twitter.txt_twitter_off);b.find(".tweet").html(y)}})}if(c){var w=r+a.services.gplus.referrer_track;var E='<div class="g-plusone" data-size="medium" data-href="'+w+'"></div><script type="text/javascript">window.___gcfg = {lang: "'+a.services.gplus.language+'"}; (function() { var po = document.createElement("script"); po.type = "text/javascript"; po.async = true; po.src = "https://apis.google.com/js/plusone.js"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(po, s); })(); </script>';var S='<img src="'+a.services.gplus.dummy_img+'" alt=""Google+1"-Dummy" class="gplus_one_dummy" />';n.append('<li class="gplus help_info"><span class="info">'+a.services.gplus.txt_info+'</span><span class="switch off">'+a.services.gplus.txt_gplus_off+'</span><div class="gplusone dummy_btn">'+S+"</div></li>");var x=e("li.gplus",n);e("li.gplus div.gplusone img,li.gplus span.switch",n).on("click",function(){if(x.find("span.switch").hasClass("off")){x.addClass("info_off");x.find("span.switch").addClass("on").removeClass("off").html(a.services.gplus.txt_gplus_on);x.find("img.gplus_one_dummy").replaceWith(E)}else{x.removeClass("info_off");x.find("span.switch").addClass("off").removeClass("on").html(a.services.gplus.txt_gplus_off);x.find(".gplusone").html(S)}})}n.append('<li class="settings_info"><div class="settings_info_menu off perma_option_off"><a href="'+a.info_link+'"><span class="help_info icon"><span class="info">'+a.txt_help+"</span></span></a></div></li>");e(".help_info:not(.info_off)",n).on("mouseenter",function(){var t=e(this);var n=window.setTimeout(function(){e(t).addClass("display")},500);e(this).data("timeout_id",n)});e(".help_info",n).on("mouseleave",function(){var t=e(this).data("timeout_id");window.clearTimeout(t);if(e(this).hasClass("display")){e(this).removeClass("display")}});var T=a.services.facebook.perma_option==="on";var N=a.services.twitter.perma_option==="on";var C=a.services.gplus.perma_option==="on";var k=typeof JSON==="object"&&typeof JSON.parse==="function";if((f&&T||l&&N||c&&C)&&k){var L=document.cookie.split(";");var A="{";var O=0;for(;O<L.length;O+=1){var M=L[O].split("=");A+='"'+e.trim(M[0])+'":"'+e.trim(M[1])+'"';if(O<L.length-1){A+=","}}A+="}";A=JSON.parse(A);var _=e("li.settings_info",n);_.find(".settings_info_menu").removeClass("perma_option_off");_.find(".settings_info_menu").append('<span class="settings">Einstellungen</span><form><fieldset><legend>'+a.settings_perma+"</legend></fieldset></form>");var D=' checked="checked"';if(f&&T){var P=A.socialSharePrivacy_facebook==="perma_on"?D:"";_.find("form fieldset").append('<input type="checkbox" name="perma_status_facebook" id="perma_status_facebook"'+P+' /><label for="perma_status_facebook">'+a.services.facebook.display_name+"</label>")}if(l&&N){var H=A.socialSharePrivacy_twitter==="perma_on"?D:"";_.find("form fieldset").append('<input type="checkbox" name="perma_status_twitter" id="perma_status_twitter"'+H+' /><label for="perma_status_twitter">'+a.services.twitter.display_name+"</label>")}if(c&&C){var B=A.socialSharePrivacy_gplus==="perma_on"?D:"";_.find("form fieldset").append('<input type="checkbox" name="perma_status_gplus" id="perma_status_gplus"'+B+' /><label for="perma_status_gplus">'+a.services.gplus.display_name+"</label>")}_.find("span.settings").css("cursor","pointer");e(_.find("span.settings"),n).on("mouseenter",function(){var t=window.setTimeout(function(){_.find(".settings_info_menu").removeClass("off").addClass("on")},500);e(this).data("timeout_id",t)});e(_,n).on("mouseleave",function(){var t=e(this).data("timeout_id");window.clearTimeout(t);_.find(".settings_info_menu").removeClass("on").addClass("off")});e(_.find("fieldset input")).on("click",function(t){var r=t.target.id;var i=r.substr(r.lastIndexOf("_")+1,r.length);var u="socialSharePrivacy_"+i;if(e("#"+t.target.id+":checked").length){s(u,"perma_on",a.cookie_expires,a.cookie_path,a.cookie_domain);e("form fieldset label[for="+r+"]",n).addClass("checked")}else{o(u,"perma_on",a.cookie_path,a.cookie_domain);e("form fieldset label[for="+r+"]",n).removeClass("checked")}});if(f&&T&&A.socialSharePrivacy_facebook==="perma_on"){e("li.facebook span.switch",n).click()}if(l&&N&&A.socialSharePrivacy_twitter==="perma_on"){e("li.twitter span.switch",n).click()}if(c&&C&&A.socialSharePrivacy_gplus==="perma_on"){e("li.gplus span.switch",n).click()}}})}})(jQuery)